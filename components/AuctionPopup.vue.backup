<template>
  <div v-if="showPopup" class="fixed inset-0 z-[9999] flex items-center justify-center p-4">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-black bg-opacity-75" @click="closePopup"></div>
    
    <!-- Popup Container -->
    <div class="relative w-full max-w-6xl mx-auto bg-white rounded-lg p-6 md:p-8">
      <!-- Close Button -->
      <button 
        @click="closePopup"
        class="absolute -top-4 -right-4 z-10 bg-white rounded-full w-10 h-10 flex items-center justify-center text-black text-2xl font-bold hover:bg-gray-200 transition shadow-lg"
      >
        Ã—
      </button>
      
      <!-- Clickable Image -->
      <a :href="config.url" class="block mb-6">
        <img 
          :src="config.image" 
          alt="Subasta La Silla"
          class="w-full h-auto rounded-lg cursor-pointer"
          @error="handleImageError"
        />
      </a>

      <!-- CTA Button -->
      <a 
        :href="config.url"
        class="block w-full bg-yellow-600 hover:bg-yellow-700 text-white text-center font-bold py-4 px-6 rounded-full text-lg md:text-xl transition duration-300 shadow-lg"
      >
        Participa de la subasta
      </a>
    </div>
  </div>
</template>

<script>
import popupConfig from '~/config/popup-config.js'

export default {
  name: 'AuctionPopup',
  data() {
    return {
      showPopup: false,
      config: popupConfig
    }
  },
  mounted() {
    if (this.config.enabled && !this.wasClosed()) {
      setTimeout(() => {
        this.showPopup = true
      }, this.config.delaySeconds * 1000)
    }
  },
  methods: {
    closePopup() {
      this.showPopup = false
      this.$cookies.set('auction_popup_closed', 'true', {
        maxAge: 60 * 60 * 24,
        path: '/'
      })
    },
    wasClosed() {
      return this.$cookies.get('auction_popup_closed') === 'true'
    },
    handleImageError() {
      console.error('Error loading popup image:', this.config.image)
      this.closePopup()
    }
  }
}
</script>
